{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Large Load Request (v0)",
  "description": "Input schema for tx-large-load v0 screening. This schema defines the product boundary for request JSONL rows; evaluator logic may apply additional semantics (e.g., completeness_check rules can treat false/empty values as missing for certain fields).",
  "type": "object",
  "required": ["project_name", "project_type", "operator_area", "tdsp_area", "load_mw_total"],
  "properties": {
    "project_name": { "type": "string", "minLength": 1, "description": "Human-readable project identifier (also used for memo filename slugging)." },
    "project_type": { "type": "string", "enum": ["large_load"], "description": "v0 supports only ERCOT large load screening requests." },
    "operator_area": { "type": "string", "enum": ["ERCOT"], "description": "Market/operator area (v0: ERCOT only)." },
    "tdsp_area": { "type": "string", "minLength": 1, "description": "TDSP service area identifier (e.g., ONCOR)." },
    "load_mw_total": { "type": "number", "exclusiveMinimum": 0, "description": "Aggregate peak demand in MW total (used by large-load applicability rules and heuristics)." },
    "energization_plan": { "type": "string", "enum": ["single", "phased"], "description": "High-level energization/commissioning plan shape used for graph branching and option levers." },
    "phases": {
      "type": "array",
      "description": "When energization_plan=phased, an ordered list of MW and target windows.",
      "items": {
        "type": "object",
        "required": ["mw", "target_window"],
        "properties": {
          "mw": { "type": "number", "exclusiveMinimum": 0, "description": "Phase MW (incremental or cumulative, depending on your internal convention)." },
          "target_window": { "type": "string", "minLength": 1, "description": "Target energization/COD window label (e.g., 2027Q2)." }
        },
        "additionalProperties": true
      }
    },
    "poi_hint": { "type": "string", "description": "Free-text POI / location hint for screening context." },
    "poi_count": { "type": "integer", "minimum": 1, "description": "Number of Points of Interconnection (POIs) under consideration for this project (v0: used as a configuration lever for path branching/what-if comparisons)." },
    "multiple_poi": { "type": "boolean", "description": "Configuration lever: whether multiple POIs are being considered (can be derived from poi_count>1; explicit value wins when provided)." },
    "is_co_located": { "type": "boolean", "description": "Configuration lever: co-located / shared infrastructure / multi-tenant adjacency signal (v0: treated as configuration complexity input for path branching/what-if comparisons)." },
    "export_capability": {
      "type": "string",
      "enum": ["none", "possible", "planned", "unknown"],
      "description": "Configuration lever: whether the site has (or plans) export capability (e.g., generation / storage export). v0 uses this as a configuration branching + risk/uncertainty input; it is not a market/settlement determination."
    },
    "voltage_choice_kv": { "type": ["number", "null"], "description": "Optional selected/assumed POI voltage choice in kV. If omitted and voltage_options_kv has a single value, evaluator may treat that value as the choice for voltage-class branching." },
    "poi_voltage_class": {
      "type": "string",
      "enum": ["distribution", "transmission", "unknown"],
      "description": "Configuration lever: voltage class at POI used for path branching. If omitted, evaluator may derive it from voltage_choice_kv using v0 thresholds (e.g., 69kV as transmission threshold for certain TDSP standards)."
    },
    "voltage_options_kv": {
      "type": "array",
      "description": "Candidate POI voltage levels in kV (preferred field name). Provide 2+ values to enable options comparison.",
      "items": { "type": "number", "exclusiveMinimum": 0 }
    },
    "voltage_options": {
      "type": "array",
      "description": "Legacy alias for voltage_options_kv (supported for backward compatibility).",
      "items": { "type": "number", "exclusiveMinimum": 0 }
    },
    "cod_target_window": { "type": "string", "description": "Requested/assumed COD window label (e.g., 2027Q4)." },
    "load_profile_type": { "type": "string", "enum": ["baseload", "ramp", "variable", "unknown"], "description": "High-level load shape label for screening (v0 informational)." },

    "is_requesting_energization": { "type": "boolean", "description": "If true, evaluator runs tri-state energization gates and renders the energization checklist." },
    "requested_energization_window": { "type": "string", "description": "Requested energization date/window (used by certain energization timing rules, e.g., '365-day' logic)." },

    "is_new_interconnection": { "type": "boolean", "description": "Whether this is a new interconnection vs modification/increase (used by applicability rules)." },
    "material_change_flags": {
      "type": "array",
      "description": "List of material change signals (e.g., poi_changed, timeline_accelerated) used for re-study screening.",
      "items": { "type": "string", "minLength": 1 }
    },

    "llis_completed_and_ercot_approved": { "type": "boolean", "description": "Energization gate input: whether required LLIS studies are completed and approved." },
    "agreements_executed": { "type": "boolean", "description": "Energization gate input: whether required agreements are executed." },
    "financial_security_posted": { "type": "boolean", "description": "Energization gate input: whether required financial security is posted." },
    "nom_included": { "type": "boolean", "description": "Energization gate input: whether the load is included in the Network Operations Model (NOM)." },

    "one_line_diagram": { "type": "boolean", "description": "Intake/completeness input (often required by TDSP). In v0 completeness semantics, false can be treated as missing." },
    "load_projection_5y": { "type": "boolean", "description": "Intake/completeness input (often required by TDSP). In v0 completeness semantics, false can be treated as missing." },
    "peak_power_factor": { "type": ["number", "null"], "description": "Peak load power factor (may be required by TDSP). null is allowed to represent unknown." },

    "load_commissioning_plan_provided": { "type": "boolean", "description": "Whether a (preliminary/current) Load Commissioning Plan is provided (key ERCOT large-load intake + energization gate)." },
    "application_fee_paid": { "type": "boolean", "description": "Whether the ERCOT LLIS application fee is paid (intake prerequisite in Planning Guide Section 9)." },

    "ack_change_notification_obligation": { "type": "boolean", "description": "v0 input representing written acknowledgement of change-notification obligation (Planning Guide Section 9.2.2/9.2.3)." },
    "llis_formal_request_submitted": { "type": "boolean", "description": "v0 input representing that a formal request to initiate LLIS has been submitted (Planning Guide Section 9.2.2)." },
    "llis_data_package_submitted": { "type": "boolean", "description": "v0 intake input representing submission of the LLIS study data package (steady state, short-circuit, motor start, stability inputs) required to initiate studies (Planning Guide Section 9.2.2(1)(a))." },

    "is_large_electronic_load": { "type": "boolean", "description": "Applicability toggle for LEL-specific energization gates and curtailment risk signals." },
    "lel_interim_assessment_complete": { "type": "boolean", "description": "If is_large_electronic_load=true, whether the interim ride-through assessment is complete." },
    "model_consistency_confirmed": { "type": "boolean", "description": "Energization gate input: confirm no material change vs the dynamic model assumptions used in studies." },
    "telemetry_operational_and_accurate": { "type": "boolean", "description": "Energization gate input: required telemetry is operational and accurate." },
    "dme_installed_and_operational": { "type": "boolean", "description": "If dme_required=true, whether Disturbance Monitoring Equipment is installed and operational." },
    "sso_complete_and_mitigation_in_place": { "type": "boolean", "description": "If sso_required=true, whether the SSO study is complete and mitigation is in place." },
    "ercot_quarterly_stability_assessment_required": { "type": ["boolean", "null"], "description": "Applicability toggle for conditional energization gate: whether ERCOT Quarterly Stability Assessment (QSA) is required for this project / target energization window. Use null to represent unknown/unconfirmed (e.g., requires TSP/ERCOT confirmation)." },
    "ercot_quarterly_stability_assessment_complete": { "type": "boolean", "description": "Energization readiness input (v0): completion of ERCOT Quarterly Stability Assessment requirements referenced by Planning Guide Section 9.6(1)(c)." },
    "notice_to_proceed_received": { "type": "boolean", "description": "Energization readiness input (v0): whether the interconnecting TSP has received notice to proceed with construction of required interconnection facilities (Planning Guide Section 9.5.1(iii))." },

    "sso_required": { "type": "boolean", "description": "Applicability toggle for conditional energization gate: whether SSO is required for this project." },
    "dme_required": { "type": "boolean", "description": "Applicability toggle for conditional energization gate: whether DME is required for this project." },
    "context": {
      "type": "object",
      "description": "Optional context snapshot (system state / engineering discretion) to make queue- and discretion-dependent signals auditable and to influence v0 risk/recommendation deterministically.",
      "properties": {
        "as_of": { "type": "string", "minLength": 1, "description": "Context snapshot timestamp (ISO 8601 recommended) indicating when the context was true/observed." },
        "signals": {
          "type": "array",
          "description": "List of context signals. Each signal should be sourced and have an explicit confidence to keep memo claims bounded and auditable.",
          "items": {
            "type": "object",
            "required": ["signal_id", "type", "value"],
            "properties": {
              "signal_id": { "type": "string", "minLength": 1, "description": "Stable identifier for the signal within a project (e.g., queue_density, tdsp_constraint, engineer_judgement)." },
              "type": { "type": "string", "minLength": 1, "description": "Signal type used for deterministic mapping into v0 risk/recommendation (often aligns with tag taxonomy, e.g., queue_density, queue_dependency, must_study)." },
              "value": {
                "description": "Signal value (recommended: low/medium/high, true/false, or a short string).",
                "type": ["string", "number", "boolean", "null"]
              },
              "confidence": { "type": "number", "minimum": 0, "maximum": 1, "description": "Confidence in this context signal (0â€“1). Used for memo display; v0 mapping uses it only for ordering/visibility, not probabilistic scoring." },
              "source": { "type": "string", "description": "Where this signal came from (URL, file, email summary, internal note). This is not citation-audited like published rules, but it is recorded for auditability." },
              "notes": { "type": "string", "description": "Optional free-text notes clarifying assumptions, scope, or caveats for this context signal." }
            },
            "additionalProperties": true
          }
        }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": true
}
